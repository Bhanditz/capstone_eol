- @taxon_concept.hierarchy_entries.each do |he|
  .entry_details{:hierarchy_entry_id => he.id, :taxon_concept_id => he.taxon_concept_id}
    %h3
      = he.hierarchy.label
    .metadata
      = "hierarchy_id: #{he.hierarchy_id}"
      %br
      = "taxon_concept_id: #{he.taxon_concept_id}"
      %br
      = "hierarchy_entry_id: #{he.id}"
    %br
    - indent = ''
    - ancestors = he.ancestor_details
    - for ancestor in ancestors
      = indent + ancestor['name_string']
      - indent << "&nbsp;&nbsp;"
      %br
    
    %strong
      = indent + he.name_object.string
    - indent << "&nbsp;&nbsp;"
    %br
    
    .children
      - children = he.children_details
      - for child in children
        = indent + child['name_string']
        %br
  %br
:javascript
  $(function() {
    $(".entry_details")
      .hover(
        function() {
          $(this).addClass('entry_hover');
        }, 
        function() {
          $(this).removeClass('entry_hover');
        }
      )
      .draggable({
        opacity: 0.50,
        revert: true,
        start: function(event, ui) {
          $("#dragging_div").attr('hierarchy_entry_id', $(this).attr('hierarchy_entry_id'));
          $(this).css('z-index', 9);
        },
        stop: function(event, ui) {
          $(this).css('z-index', 10);
        }
      })
      .mouseup(function(event, ui) {
        dragged_div = $('.entry_details[hierarchy_entry_id$=' + $("#dragging_div").attr('hierarchy_entry_id') + ']');
        if(dragged_div == undefined) {
          return;
        }
        dragged_div.css('z-index', 10);
        $("#dragging_div").removeAttr('hierarchy_entry_id');
        
        
        dropped_div = $(".entry_hover");
        if(dropped_div == undefined || $("#dragging_div").attr('hierarchy_entry_id') == undefined) {
          return;
        }
        if(dropped_div.attr('hierarchy_entry_id') == dragged_div.attr('hierarchy_entry_id')) {
          return;
        }
        
        if(dragged_div.attr('taxon_concept_id') == dropped_div.attr('taxon_concept_id')) {
          alert('Cannot drop - same concept');
        }else {
          alert('Dropping '+ dragged_div.attr('hierarchy_entry_id') + ' to ' + $(dropped_div).attr('hierarchy_entry_id'));
        }
      
      });
  });